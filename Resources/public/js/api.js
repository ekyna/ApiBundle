define("ekyna-api/api",["routing","es6-promise","jquery"],function(a,t,r){"use strict";t.polyfill();let e=t.Promise;function o(t){const e=window.localStorage;e&&e.removeItem(t)}const n={route:null,token:null,loading:!1};return n.load=function(){var i;this.loading||this.route&&(this.loading=!0,i=this.route,new e(function(e,t){let n=window.localStorage;if(n){let t=n.getItem(i);if(t&&(t=JSON.parse(t),t.hasOwnProperty("expires_at")&&t.expires_at>Math.floor((new Date).getTime()/1e3)))return void e(t.token)}let o=r.ajax({url:a.generate(i),method:"GET"});o.done(function(t){n&&n.setItem(i,JSON.stringify(t)),e(t.token)}),o.fail(function(){t()})}).then(t=>{this.token=t,this.loading=!1},()=>{o(this.route),this.token=null,this.loading=!1}))},n.init=function(t){this.route=t,this.load(),r(document).ajaxError((t,e,n)=>{401===e.status&&0===new URL(n.url,window.location.href).pathname.indexOf("/api")&&(o(this.route),this.token=null,this.load())}),r(document).ajaxSend((t,e)=>{this.token&&e.setRequestHeader("X-Auth-Token",this.token)})},n});